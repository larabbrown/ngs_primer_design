<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lara Brown">

<title>Primer Design</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="primer_design_files/libs/clipboard/clipboard.min.js"></script>
<script src="primer_design_files/libs/quarto-html/quarto.js"></script>
<script src="primer_design_files/libs/quarto-html/popper.min.js"></script>
<script src="primer_design_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="primer_design_files/libs/quarto-html/anchor.min.js"></script>
<link href="primer_design_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="primer_design_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="primer_design_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="primer_design_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="primer_design_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Primer Design</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Lara Brown </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Jun 2, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>This notebook, along with the README in this repository, provides an overview of primer generation for multiplex PCR, when the interactions/dimer formation of multiple sets of primers is a concern. This combination of an initial pipeline followed by a number of more qualitative/manual steps ideally generates primers for a number of different targets, none of which form cross-dimers with low enough Gibbs free energies to be of concern in an experimental setting.</p>
<p>For the actual primer generation process for a specific project, see the R file and associated data files in the <code>manual_primers_20230228</code> subdirectory. Most of that code is included here, but it contains some additional messy details and processing.</p>
<section id="generating-a-primer-set-with-primer3" class="level2">
<h2 class="anchored" data-anchor-id="generating-a-primer-set-with-primer3">Generating a primer set with Primer3</h2>
<p>Utilize the web interface of primer3 to generate an initial primer set containing up to five ranked primer pairs per target. Note that while primer3 can also be run through the command line, the default arguments seem to be different; until we can figure out exactly how to replicate our preferred settings, it’s easy enough to just run it through the web interface.</p>
<p>See “primer3 settings for NGS primers.pptx” for more info.</p>
</section>
<section id="running-primerdimer" class="level2">
<h2 class="anchored" data-anchor-id="running-primerdimer">Running PrimerDimer</h2>
<p>Once we have all our potential primers, we wish to calculate the cross-dimerization energies of all possible pairs of primers in the set. For this, we’ll use a program called PrimerDimer.</p>
<p>First, reformat the primer3 output into FASTA format:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>df_primer <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"manual_primers_20230228/manual_primers_20230228.csv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>df_primers_formatted <span class="ot">&lt;-</span> df_primer <span class="sc">%&gt;%</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fasta_header =</span> <span class="fu">paste</span>(Target, oligo, Rank, <span class="at">sep=</span><span class="st">"|"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fasta_header, seq)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write.fasta</span>(<span class="fu">as.list</span>(df_primers_formatted<span class="sc">$</span>seq), <span class="fu">as.list</span>(df_primers_formatted<span class="sc">$</span>fasta_header), <span class="st">"manual_primers_20230228/primer-dimer_input.fasta"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, navigate to <a href="primer-dimer.com">primer-dimer.com</a>. Copy and paste the FASTA file into the input box. Select “multiplex analysis” and “excel summary report,” and run, saving the results into a csv file. Finally, read in the PrimerDimer predictions as a dataframe:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df_dimer <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"manual_primers_20230228/dimer_prediction_report_20230228.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 12720 Columns: 6
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (5): Forward Primer Name, Forward Primer Seq, Reverse Primer Name, Rever...
dbl (1): dG

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Reformat this dataframe into a long format representation of a symmetric matrix. Each interaction between Primer X and Primer Y should be represented twice in the dataframe, once with Primer X in the <code>_a</code> position, and once with Primer X in the <code>_b</code> position. The identifying fields (target, direction, and pair number) are also split into three separate columns instead of the PrimerDimer format of a single string.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df_dimer_lower <span class="ot">&lt;-</span> df_dimer <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_delim</span>(<span class="st">"Forward Primer Name"</span>, <span class="st">"|"</span>, <span class="at">names=</span><span class="fu">c</span>(<span class="st">"id_target_a"</span>, <span class="st">"direction_a"</span>, <span class="st">"id_pair_a"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_delim</span>(<span class="st">"Reverse Primer Name"</span>, <span class="st">"|"</span>, <span class="at">names=</span><span class="fu">c</span>(<span class="st">"id_target_b"</span>, <span class="st">"direction_b"</span>, <span class="st">"id_pair_b"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_target_a, direction_a, id_pair_a, id_target_b, direction_b, id_pair_b, dG)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>df_dimer_upper <span class="ot">&lt;-</span> df_dimer_lower <span class="sc">%&gt;%</span> </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">id_target_a =</span> id_target_b,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">id_target_b =</span> id_target_a,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">id_pair_a =</span> id_pair_b,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">id_pair_b =</span> id_pair_a,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">direction_a =</span> direction_b,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">direction_b =</span> direction_a) <span class="sc">%&gt;%</span> </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_target_a, direction_a, id_pair_a, id_target_b, direction_b, id_pair_b, dG) <span class="co"># ensure column order matches lower tri</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>df_dimer_symmetric <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_dimer_lower, df_dimer_upper)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="quick-validation" class="level2">
<h2 class="anchored" data-anchor-id="quick-validation">Quick Validation</h2>
<p>Quickly check a known pair to verify that it indeed appears twice with the same dG value in the dataframe:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df_dimer_symmetric <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((id_target_a <span class="sc">==</span> <span class="dv">12</span> <span class="sc">&amp;</span> direction_a <span class="sc">==</span> <span class="st">"RIGHT"</span> <span class="sc">&amp;</span> id_pair_a <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> id_target_b <span class="sc">==</span> <span class="dv">7</span> <span class="sc">&amp;</span> direction_b <span class="sc">==</span> <span class="st">"LEFT"</span> <span class="sc">&amp;</span> id_pair_b <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">|</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>         (id_target_a <span class="sc">==</span> <span class="dv">7</span> <span class="sc">&amp;</span> direction_a <span class="sc">==</span> <span class="st">"LEFT"</span> <span class="sc">&amp;</span> id_pair_a <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> id_target_b <span class="sc">==</span> <span class="dv">12</span> <span class="sc">&amp;</span> direction_b <span class="sc">==</span> <span class="st">"RIGHT"</span> <span class="sc">&amp;</span> id_pair_b <span class="sc">==</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="hard-filtering" class="level2">
<h2 class="anchored" data-anchor-id="hard-filtering">Hard filtering</h2>
<p>To begin, we remove any primers with an average dG across all their interactions less than or equal to -7.</p>
<p>First, create a dataframe of all the valid primers (primers that do not fail this check):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_valid_primers <span class="ot">&lt;-</span> df_dimer_symmetric <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_target_a, direction_a, id_pair_a) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg =</span> <span class="fu">mean</span>(dG, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_below_neg10 =</span> <span class="fu">sum</span>(dG <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">10</span>),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_below_neg7 =</span> <span class="fu">sum</span>(dG <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">7</span>),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_below_neg6 =</span> <span class="fu">sum</span>(dG <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">6</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(avg <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_target_a, direction_a, id_pair_a) <span class="sc">%&gt;%</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">target =</span> id_target_a,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">direction =</span> direction_a,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">pair =</span> id_pair_a) <span class="sc">%&gt;%</span> </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">retain =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, filter the “symmetric” dataframe so it only includes pairs where both primers are in the valid set:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df_valid_pairs <span class="ot">&lt;-</span> df_dimer_symmetric <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_valid_primers,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">by=</span><span class="fu">c</span>(<span class="st">"id_target_a"</span> <span class="ot">=</span> <span class="st">"target"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"direction_a"</span> <span class="ot">=</span> <span class="st">"direction"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"id_pair_a"</span> <span class="ot">=</span> <span class="st">"pair"</span>),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">multiple=</span><span class="st">"all"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(retain) <span class="sc">%&gt;%</span> </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_valid_primers,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">by=</span><span class="fu">c</span>(<span class="st">"id_target_b"</span> <span class="ot">=</span> <span class="st">"target"</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"direction_b"</span> <span class="ot">=</span> <span class="st">"direction"</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"id_pair_b"</span> <span class="ot">=</span> <span class="st">"pair"</span>),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">multiple=</span><span class="st">"all"</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">suffix=</span><span class="fu">c</span>(<span class="st">".sym"</span>, <span class="st">".val"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(retain.val) <span class="sc">%&gt;%</span> </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>retain.sym, <span class="sc">-</span>retain.val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="recursive-filtering" class="level2">
<h2 class="anchored" data-anchor-id="recursive-filtering">Recursive filtering</h2>
<p>We now successively filter the primer dataframe, culling “bad” interactions, until we are left with a set of pairs with no cross-dimers with Gibbs free energies less than a set threshold (-7 in this case). However, note that we may lose some targets entirely in the process. In the example below, we see that we are usually left with fewer than the desired 40 targets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">func_recurs_filter_primers</span>(df_valid_pairs, <span class="sc">-</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">func_count_targets</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13</code></pre>
</div>
</div>
<p>Therefore, we run this filtering process repeatedly, 300 times, and choose the set that retains the most targets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df_selected_set <span class="ot">&lt;-</span> <span class="fu">func_get_best_run</span>(df_valid_pairs, <span class="dv">300</span>, <span class="sc">-</span><span class="dv">9</span>, <span class="at">random=</span><span class="cn">TRUE</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(df_selected_set, <span class="st">"manual_primers_20230228/init_set_20230301.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can save this dataframe, and in the future, read it back in so we don’t have to rerun this step.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df_selected_set <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"manual_primers_20230228/init_set_20230301.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 58 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): direction_a
dbl (3): id_target_a, id_pair_a, n

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
</section>
<section id="filling-in-the-gaps" class="level2">
<h2 class="anchored" data-anchor-id="filling-in-the-gaps">Filling in the gaps</h2>
<p>As mentioned, at this point, we’ve likely removed a number of targets entirely. We can easily figure out which targets are missing only a primer in one direction, and can visually assess which are missing entirely.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df_missing_oneway <span class="ot">&lt;-</span> df_selected_set <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_target_a) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  ungroup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="overview-of-missing-targets" class="level3">
<h3 class="anchored" data-anchor-id="overview-of-missing-targets">Overview of missing targets</h3>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Target</th>
<th style="text-align: center;">Direction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">9</td>
<td style="text-align: center;">LEFT</td>
</tr>
<tr class="even">
<td style="text-align: center;">13</td>
<td style="text-align: center;">RIGHT</td>
</tr>
<tr class="odd">
<td style="text-align: center;">15</td>
<td style="text-align: center;">BOTH</td>
</tr>
<tr class="even">
<td style="text-align: center;">14</td>
<td style="text-align: center;">BOTH</td>
</tr>
<tr class="odd">
<td style="text-align: center;">16</td>
<td style="text-align: center;">LEFT</td>
</tr>
<tr class="even">
<td style="text-align: center;">20</td>
<td style="text-align: center;">BOTH</td>
</tr>
</tbody>
</table>
</section>
<section id="pulling-all-valid-primers-for-missing-targets" class="level3">
<h3 class="anchored" data-anchor-id="pulling-all-valid-primers-for-missing-targets">Pulling all valid primers for missing targets</h3>
<p>Return to the dataframe of valid primers (generated after hard filtering step) to figure out which primers we might include for these missing sites:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df_missing_options <span class="ot">&lt;-</span> df_valid_primers <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((target <span class="sc">==</span> <span class="dv">9</span> <span class="sc">&amp;</span> direction <span class="sc">==</span> <span class="st">"RIGHT"</span>) <span class="sc">|</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>         (target <span class="sc">==</span> <span class="dv">13</span> <span class="sc">&amp;</span> direction <span class="sc">==</span> <span class="st">"RIGHT"</span>) <span class="sc">|</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>         (target <span class="sc">==</span> <span class="dv">16</span> <span class="sc">&amp;</span> direction <span class="sc">==</span> <span class="st">"LEFT"</span>) <span class="sc">|</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>         (target <span class="sc">==</span> <span class="dv">14</span>) <span class="sc">|</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>         (target <span class="sc">==</span> <span class="dv">15</span>) <span class="sc">|</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>         (target <span class="sc">==</span> <span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From this, we find our options are:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Target</th>
<th style="text-align: center;">Direction</th>
<th style="text-align: center;">Pair/rank id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">9</td>
<td style="text-align: center;">RIGHT</td>
<td style="text-align: center;">0,1</td>
</tr>
<tr class="even">
<td style="text-align: center;">13</td>
<td style="text-align: center;">RIGHT</td>
<td style="text-align: center;">0,1,2,3,4</td>
</tr>
<tr class="odd">
<td style="text-align: center;">15</td>
<td style="text-align: center;">LEFT</td>
<td style="text-align: center;">0,1</td>
</tr>
<tr class="even">
<td style="text-align: center;">15</td>
<td style="text-align: center;">RIGHT</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">14</td>
<td style="text-align: center;">LEFT</td>
<td style="text-align: center;">0,1</td>
</tr>
<tr class="even">
<td style="text-align: center;">14</td>
<td style="text-align: center;">RIGHT</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">16</td>
<td style="text-align: center;">LEFT</td>
<td style="text-align: center;">none</td>
</tr>
<tr class="even">
<td style="text-align: center;">20</td>
<td style="text-align: center;">LEFT</td>
<td style="text-align: center;">0,1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">20</td>
<td style="text-align: center;">RIGHT</td>
<td style="text-align: center;">0,1</td>
</tr>
</tbody>
</table>
<p>Join these targets to our earlier selected set, and choose the best primer for each target-direction pair:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df_full_set_to_eval <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id_target_a =</span> <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">13</span>,<span class="dv">13</span>,<span class="dv">13</span>,<span class="dv">13</span>,<span class="dv">13</span>,<span class="dv">15</span>,<span class="dv">15</span>,<span class="dv">15</span>,<span class="dv">14</span>,<span class="dv">14</span>,<span class="dv">14</span>,<span class="dv">20</span>,<span class="dv">20</span>,<span class="dv">16</span>),</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">direction_a =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"RIGHT"</span>, <span class="st">"RIGHT"</span>, <span class="st">"RIGHT"</span>, <span class="st">"RIGHT"</span>, <span class="st">"RIGHT"</span>, <span class="st">"LEFT"</span>, <span class="st">"LEFT"</span>, <span class="st">"RIGHT"</span>, <span class="st">"LEFT"</span>, <span class="st">"LEFT"</span>, <span class="st">"RIGHT"</span>, <span class="st">"LEFT"</span>, <span class="st">"RIGHT"</span>,<span class="st">"LEFT"</span>),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">id_pair_a =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(df_selected_set) <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_target_a, direction_a) <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">id_target =</span> id_target_a,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">direction =</span> direction_a,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">id_pair =</span> id_pair_a) <span class="sc">%&gt;%</span> </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">retain=</span><span class="cn">TRUE</span>,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">id_target =</span> <span class="fu">as.character</span>(id_target),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">id_pair =</span> <span class="fu">as.character</span>(id_pair)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_target, direction) <span class="sc">%&gt;%</span> <span class="co"># choose best ranked primer for each target-direction pair</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(<span class="at">order_by=</span>id_pair)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="identifying-interactions-across-this-reduced-set" class="level3">
<h3 class="anchored" data-anchor-id="identifying-interactions-across-this-reduced-set">Identifying interactions across this reduced set</h3>
<p>At this point, we enter into a bit of a guess-and-check cycle, re-evaluting interactions in our chosen set until we settle on a set that mostly works.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df_dimer_symmetric <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_full_set_to_eval, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"id_target_a"</span> <span class="ot">=</span> <span class="st">"id_target"</span>, <span class="st">"direction_a"</span> <span class="ot">=</span> <span class="st">"direction"</span>, <span class="st">"id_pair_a"</span> <span class="ot">=</span> <span class="st">"id_pair"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(retain) <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>retain) <span class="sc">%&gt;%</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_full_set_to_eval, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"id_target_b"</span> <span class="ot">=</span> <span class="st">"id_target"</span>, <span class="st">"direction_b"</span> <span class="ot">=</span> <span class="st">"direction"</span>, <span class="st">"id_pair_b"</span> <span class="ot">=</span> <span class="st">"id_pair"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(retain) <span class="sc">%&gt;%</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>retain) <span class="sc">%&gt;%</span> </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(dG) <span class="sc">%&gt;%</span> </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We observe the following problematic interactions and note potential replacement options based on <code>df_selected_set</code>:</p>
<table class="table">
<colgroup>
<col style="width: 41%">
<col style="width: 29%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Interaction</th>
<th style="text-align: left;">Alternatives for A</th>
<th style="text-align: left;">Alternatives for B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1R2 <span class="math inline">\(\leftrightarrow\)</span> 3L0</td>
<td style="text-align: left;">1R4</td>
<td style="text-align: left;">3L1, 3L3</td>
</tr>
<tr class="even">
<td style="text-align: center;">12R1 <span class="math inline">\(\leftrightarrow\)</span> 14R0</td>
<td style="text-align: left;">12R2</td>
<td style="text-align: left;">None</td>
</tr>
<tr class="odd">
<td style="text-align: center;">8R2 <span class="math inline">\(\leftrightarrow\)</span> 14R0</td>
<td style="text-align: left;">8R3, 8R4</td>
<td style="text-align: left;">None</td>
</tr>
<tr class="even">
<td style="text-align: center;">10R1 <span class="math inline">\(\leftrightarrow\)</span> 19R0</td>
<td style="text-align: left;"><strong>10R2</strong>, 10R3</td>
<td style="text-align: left;">19R2</td>
</tr>
<tr class="odd">
<td style="text-align: center;">6R0 <span class="math inline">\(\leftrightarrow\)</span> 13R0</td>
<td style="text-align: left;">6R2</td>
<td style="text-align: left;">13R1,2,3,4 (all worse, keep as is)</td>
</tr>
<tr class="even">
<td style="text-align: center;">9L0 <span class="math inline">\(\leftrightarrow\)</span> 5R0</td>
<td style="text-align: left;">9L1</td>
<td style="text-align: left;">5R1</td>
</tr>
</tbody>
</table>
<p>Implement these desired replacements to improve the selected set:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df_replacement <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id_target =</span> <span class="fu">c</span>(<span class="st">"3"</span>, <span class="st">"10"</span>, <span class="st">"8"</span>, <span class="st">"1"</span>, <span class="st">"4"</span>, <span class="st">"9"</span>),</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">direction =</span> <span class="fu">c</span>(<span class="st">"LEFT"</span>, <span class="st">"RIGHT"</span>, <span class="st">"RIGHT"</span>, <span class="st">"LEFT"</span>, <span class="st">"RIGHT"</span>, <span class="st">"LEFT"</span>),</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">id_pair =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"0"</span>, <span class="st">"3"</span>, <span class="st">"1"</span>),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">retain =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(df_full_set_to_eval) <span class="sc">%&gt;%</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(id_target <span class="sc">==</span> <span class="st">"3"</span> <span class="sc">&amp;</span> direction <span class="sc">==</span> <span class="st">"LEFT"</span> <span class="sc">&amp;</span> id_pair <span class="sc">==</span> <span class="st">"0"</span>),</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>         <span class="co"># !(id_target == "14" &amp; direction == "RIGHT" &amp; id_pair == "0"),</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>(id_target <span class="sc">==</span> <span class="st">"10"</span> <span class="sc">&amp;</span> direction <span class="sc">==</span> <span class="st">"RIGHT"</span> <span class="sc">&amp;</span> id_pair <span class="sc">==</span> <span class="st">"1"</span>),</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>(id_target <span class="sc">==</span> <span class="st">"8"</span> <span class="sc">&amp;</span> direction <span class="sc">==</span> <span class="st">"RIGHT"</span> <span class="sc">&amp;</span> id_pair <span class="sc">==</span> <span class="st">"2"</span>),</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>(id_target <span class="sc">==</span> <span class="st">"4"</span> <span class="sc">&amp;</span> direction <span class="sc">==</span> <span class="st">"RIGHT"</span> <span class="sc">&amp;</span> id_pair <span class="sc">==</span> <span class="st">"1"</span>),</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>(id_target <span class="sc">==</span> <span class="st">"1"</span> <span class="sc">&amp;</span> direction <span class="sc">==</span> <span class="st">"LEFT"</span> <span class="sc">&amp;</span> id_pair <span class="sc">==</span> <span class="st">"1"</span>),</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>(id_target <span class="sc">==</span> <span class="st">"9"</span> <span class="sc">&amp;</span> direction <span class="sc">==</span> <span class="st">"LEFT"</span> <span class="sc">&amp;</span> id_pair <span class="sc">==</span> <span class="st">"0"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df_dimer_symmetric <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_replacement, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"id_target_a"</span> <span class="ot">=</span> <span class="st">"id_target"</span>, <span class="st">"direction_a"</span> <span class="ot">=</span> <span class="st">"direction"</span>, <span class="st">"id_pair_a"</span> <span class="ot">=</span> <span class="st">"id_pair"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(retain) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>retain) <span class="sc">%&gt;%</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_replacement, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"id_target_b"</span> <span class="ot">=</span> <span class="st">"id_target"</span>, <span class="st">"direction_b"</span> <span class="ot">=</span> <span class="st">"direction"</span>, <span class="st">"id_pair_b"</span> <span class="ot">=</span> <span class="st">"id_pair"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(retain) <span class="sc">%&gt;%</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>retain) <span class="sc">%&gt;%</span> </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(dG) <span class="sc">%&gt;%</span> </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I noted the following problems, which I just iterated on until I resolved them the best I could:</p>
<ul>
<li>14R has to be 0 or 1 <span class="math inline">\(\rightarrow\)</span> set to 0, and change 8R2 <span class="math inline">\(\rightarrow\)</span> 8R3 (no solution to help interaction with 12R1; using 12R2 kept interaction and 12R3 had bad interactions with others)</li>
<li>16L has to be 1,2,3 <span class="math inline">\(\rightarrow\)</span>
<ul>
<li>16L3 has -7.04 for everything except with 18R1 at -7.14</li>
<li>16L1 has -7.01 with one interaction with 3L1 at -7.17</li>
<li>16L2 has -7.24</li>
<li>16L0 has -6.99, but has one interaction with 13R0 at -11.7</li>
</ul></li>
<li>20R has to be 0,1
<ul>
<li>if set 20R0, need to change 5R0 and 14R0 (but can’t change 14R0). 5R1 is only other option and it has numerous bad interactions</li>
<li>if set 20R1, need to change 4R1, 15R1, 1L1</li>
</ul></li>
<li>changing 4R1 to …
<ul>
<li>4R0 <span class="math inline">\(\leftrightarrow\)</span> 3L1 -7.7;</li>
<li>4R2 <span class="math inline">\(\leftrightarrow\)</span> 5L1 -7.53;</li>
<li>4R3 <span class="math inline">\(\leftrightarrow\)</span> 4L4 -7.05;</li>
<li>4R4 <span class="math inline">\(\leftrightarrow\)</span> 5L1 -7 and 4R4 <span class="math inline">\(\leftrightarrow\)</span> 18R1 -8.13</li>
</ul></li>
<li>15R: 15R0 is only other option and it has -10.8 for almost everything</li>
<li>1L: 1L1 resolves 20R1 interaction</li>
</ul>
<p>We can repeat this above process a few times, making slight changes, and save several different options for our primer sets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(df_replacement, <span class="st">"manual_primers_20230228/chosen_primer_set_4.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="validating-primer-sets" class="level2">
<h2 class="anchored" data-anchor-id="validating-primer-sets">Validating primer sets</h2>
<p>Previously, we used openPrimeR to visualize boxplots of dGs for each primer set to ensure all interactions fell above a reasonable threshold. (openPrimeR seemed to be less stringent than PrimerDimer in calculating free energies of dimer formation). Unfortunately, the OligoArrayAux dependency for these calculations is no longer available or supported, so we cannot replicate this step. I’m including the code below for reference anyway.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"functions_check_opr_constraints.R"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">func_eval_primers_in_dir</span>(<span class="st">"manual_primers_20230228/chosen_primer_sets"</span>, <span class="st">"manual_primers_20230228/manual_primers_20230228.csv"</span>, <span class="st">"manual_primers_20230228/chosen_primer_fastas"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>